{% extends "base.html" %}

{% block title %}CHALLENGES - CTF PLATFORM{% endblock %}

{% block content %}
<div class="mb-8">
    <h1 class="text-5xl font-black uppercase tracking-tight">â–  CHALLENGES</h1>
    <p class="mt-2 text-xl">SOLVE TO EARN POINTS AND DOMINATE THE LEADERBOARD</p>
</div>

<!-- SEARCH AND FILTER BAR -->
<div class="mb-8 border-4 border-red-600 p-6 bg-black">
    <form method="GET" action="{{ url_for('challenges.list') }}" class="grid md:grid-cols-4 gap-4">
        <!-- Category Filter -->
        <div>
            <label class="block font-black uppercase text-sm mb-2">CATEGORY</label>
            <select name="category" class="w-full bg-black border-2 border-red-600 p-2 font-bold uppercase text-sm">
                <option value="">ALL CATEGORIES</option>
                {% for cat in categories %}
                <option value="{{ cat }}" {% if current_category == cat %}selected{% endif %}>{{ cat|upper }}</option>
                {% endfor %}
            </select>
        </div>
        
        <!-- Source Filter -->
        <div>
            <label class="block font-black uppercase text-sm mb-2">SOURCE</label>
            <select name="source" class="w-full bg-black border-2 border-red-600 p-2 font-bold uppercase text-sm">
                <option value="">ALL SOURCES</option>
                <option value="official" {% if current_source == 'official' %}selected{% endif %}>OFFICIAL</option>
                <option value="community" {% if current_source == 'community' %}selected{% endif %}>COMMUNITY</option>
            </select>
        </div>
        
        <!-- Search Box -->
        <div>
            <label class="block font-black uppercase text-sm mb-2">SEARCH</label>
            <input type="text" 
                   name="search" 
                   value="{{ current_search or '' }}"
                   placeholder="SEARCH CHALLENGES..."
                   class="w-full bg-black border-2 border-red-600 p-2 font-bold uppercase text-sm">
        </div>
        
        <!-- Submit Button -->
        <div class="flex items-end">
            <button type="submit" class="w-full bg-red-600 text-black p-2 font-black uppercase text-sm border-2 border-white hover:bg-white">
                â–º FILTER
            </button>
        </div>
    </form>
    
    <!-- Clear Filters -->
    {% if current_category or current_source or current_search %}
    <div class="mt-4 text-center">
        <a href="{{ url_for('challenges.list') }}" class="text-red-600 font-bold uppercase text-sm hover:text-white">
            âœ• CLEAR ALL FILTERS
        </a>
    </div>
    {% endif %}
</div>

<!-- Results Count -->
<div class="mb-4 text-sm font-bold uppercase">
    SHOWING {{ challenges|length }} CHALLENGE{% if challenges|length != 1 %}S{% endif %}
</div>

{% set categories_grouped = challenges|groupby('category') %}

{% for category, challs in categories_grouped %}
<div class="mb-12">
    <h2 class="text-3xl font-black uppercase mb-6 pb-2 border-b-4 border-red-600">
        â–“ {{ category|upper }}
    </h2>
    
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for challenge in challs %}
            <div class="bg-black border-3 border-red-600 p-6 hover-brutal shadow-lg">
                <div class="flex justify-between items-start mb-4">
                    <h3 class="text-xl font-black uppercase flex-1">
                        {{ challenge.title }}
                    </h3>
                    <span class="bg-red-600 text-black px-3 py-1 font-black text-sm border-2 border-white ml-2">
                        {{ challenge.points }}
                    </span>
                </div>
                
                <div class="mb-3 flex flex-wrap gap-2">
                    {% if challenge.author.is_admin %}
                    <span class="bg-black text-red-600 border-2 border-red-600 px-2 py-1 text-xs font-black uppercase">
                        [OFFICIAL]
                    </span>
                    {% else %}
                    <span class="bg-black text-white border-2 border-white px-2 py-1 text-xs font-black uppercase">
                        [COMMUNITY]
                    </span>
                    {% endif %}
                    
                    {% if challenge.difficulty == 'easy' %}
                    <span class="border-2 border-green-500 text-green-500 px-2 py-1 text-xs font-black uppercase">
                        [EASY]
                    </span>
                    {% elif challenge.difficulty == 'medium' %}
                    <span class="border-2 border-yellow-500 text-yellow-500 px-2 py-1 text-xs font-black uppercase">
                        [MED]
                    </span>
                    {% else %}
                    <span class="border-2 border-red-600 text-red-600 px-2 py-1 text-xs font-black uppercase">
                        [HARD]
                    </span>
                    {% endif %}
                </div>
                
                <p class="text-sm mb-3 opacity-80">BY {{ challenge.author.username|upper }}</p>
                
                <p class="mb-4 text-sm leading-relaxed">
                    {{ challenge.description[:120] }}{% if challenge.description|length > 120 %}...{% endif %}
                </p>
                
                <div class="flex justify-between items-center border-t-2 border-red-600 pt-4">
                    <span class="text-sm font-bold">
                        ðŸŽ¯ {{ challenge.solve_count() }} SOLVES
                    </span>
                    
                    <a href="{{ url_for('challenges.detail', challenge_id=challenge.id) }}" 
                       class="bg-red-600 text-black px-4 py-2 font-black uppercase text-sm border-2 border-black hover:bg-white hover:text-black">
                        SOLVE â†’
                    </a>
                </div>
            </div>
        {% endfor %}
    </div>
</div>
{% else %}
    <div class="text-center py-20 border-4 border-red-600">
        <p class="text-3xl font-black uppercase">NO CHALLENGES FOUND</p>
        <p class="mt-2">TRY DIFFERENT FILTERS</p>
        <a href="{{ url_for('challenges.list') }}" class="inline-block mt-4 bg-red-600 text-black px-6 py-3 font-black uppercase hover:bg-white">
            VIEW ALL CHALLENGES
        </a>
    </div>
{% endfor %}

{% endblock %}
